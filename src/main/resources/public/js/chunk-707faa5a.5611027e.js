(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-707faa5a"],{1:function(e,t){},2:function(e,t){},"2b1a":function(e,t,a){"use strict";var i=a("c961"),n=a.n(i);n.a},3:function(e,t){},"333d":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[e.total>0?a("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1)):e._e()],1)},n=[];a("163d");Math.easeInOutQuad=function(e,t,a,i){return e/=i/2,e<1?a/2*e*e+t:(e--,-a/2*(e*(e-2)-1)+t)};var o=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function r(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function l(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function s(e,t,a){var i=l(),n=e-i,s=20,c=0;t="undefined"===typeof t?500:t;var u=function e(){c+=s;var l=Math.easeInOutQuad(c,i,n,t);r(l),c<t?o(e):a&&"function"===typeof a&&a()};u()}var c={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}},pageSize:{get:function(){return this.limit},set:function(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange:function(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&s(0,800)},handleCurrentChange:function(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&s(0,800)}}},u=c,d=(a("3613"),a("623f")),p=Object(d["a"])(u,i,n,!1,null,"5a1061f0",null);t["a"]=p.exports},3613:function(e,t,a){"use strict";var i=a("5a15"),n=a.n(i);n.a},"5a15":function(e,t,a){},"7d4c":function(e,t,a){"use strict";var i=a("f82d"),n=a.n(i);n.a},9210:function(e,t,a){"use strict";var i=a("9512"),n=a.n(i);n.a},9512:function(e,t,a){},c466:function(e,t,a){"use strict";function i(e){var t=new Date(e),a=t.getMonth()+1;return t.getFullYear()+"年"+a+"月"+t.getDate()+"日"}function n(e){var t=new Date(e),a=t.getHours(),i=t.getMinutes(),n=t.getSeconds();return(a<10?"0":"")+a+":"+(i<10?"0":"")+i+":"+(n<10?"0":"")+n}function o(e){var t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate();return t+"-"+(a<10?"0":"")+a+"-"+(i<10?"0":"")+i}a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return o}))},c961:function(e,t,a){},cf45:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return o}));var i=a("61f7");function n(e,t,a){t.data=e.records,t.total=e.total,t.page=e.current,a&&a()}function o(e){return Object(i["c"])(e)?null:e}},d2f8:function(e,t,a){},eb01:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",[a("el-aside",{staticStyle:{width:"auto"}},[a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":e.activeMenu,collapse:e.menuCollapse},on:{select:e.handleSelect}},[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"text"},on:{click:function(t){e.menuCollapse=!e.menuCollapse}}},[e.menuCollapse?a("i",{staticClass:"el-icon-arrow-right"}):a("i",{staticClass:"el-icon-arrow-left"})]),e._v(" "),e._l(e.menu,(function(t){return a("el-menu-item",{key:t.index,attrs:{index:t.index,name:t.index}},[a("svg-icon",{attrs:{"icon-class":t.class}}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.title))])],1)}))],2)],1),e._v(" "),null!==e.project?a("el-main",["base-info"!==e.activeMenu?a("el-card",[a("span",[e._v("当前项目："+e._s(e.project.name)+" ("+e._s(e.project.projectId)+")")]),e._v(" "),e._l(e.project.roles,(function(t){return a("span",[a("el-divider",{attrs:{direction:"vertical"}}),e._v("\n        "+e._s(t.detail)+"\n      ")],1)})),e._v(" "),a("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),a("span",[e._v(e._s(e.getDate(e.project.scheduledDate))+" - "+e._s(e.getDate(e.project.deliveryDate)))])],2):e._e(),e._v(" "),a("div",{staticStyle:{"margin-top":"30px"}},["base-info"===e.activeMenu?a("base-info"):e._e(),e._v(" "),"participant"===e.activeMenu?a("participant"):e._e(),e._v(" "),"function-list"===e.activeMenu?a("function-list"):e._e(),e._v(" "),"risk"===e.activeMenu?a("risk"):e._e(),e._v(" "),"defect"===e.activeMenu?a("defect"):e._e(),e._v(" "),"device"===e.activeMenu?a("device"):e._e(),e._v(" "),"work-hour"===e.activeMenu?a("work-hour"):e._e(),e._v(" "),"file"===e.activeMenu?a("file"):e._e()],1)],1):e._e()],1)},n=[],o=(a("f548"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h2",[e._v("项目信息")]),e._v(" "),a("div",[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",staticStyle:{width:"80%"},attrs:{model:e.form,rules:e.submitRules,"hide-required-asterisk":!0,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"项目ID"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{name:"projectId",disabled:""},model:{value:e.form.projectId,callback:function(t){e.$set(e.form,"projectId",t)},expression:"form.projectId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[a("el-input",{attrs:{name:"projectName"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户信息",prop:"clientId"}},[a("el-input",{attrs:{name:"clientId"},model:{value:e.form.clientId,callback:function(t){e.$set(e.form,"clientId",t)},expression:"form.clientId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"预定时间",prop:"scheduledDate"}},[a("el-date-picker",{staticStyle:{width:"50%"},attrs:{type:"date",name:"scheduledDate",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},model:{value:e.form.scheduledDate,callback:function(t){e.$set(e.form,"scheduledDate",t)},expression:"form.scheduledDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"交付时间",prop:"deliveryDate"}},[a("el-date-picker",{staticStyle:{width:"50%"},attrs:{type:"date",name:"deliveryDate",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd","picker-options":{disabledDate:function(t){return t.getTime()<new Date(e.form.scheduledDate)}}},model:{value:e.form.deliveryDate,callback:function(t){e.$set(e.form,"deliveryDate",t)},expression:"form.deliveryDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目上级",prop:"superior"}},[a("el-select",{attrs:{name:"projectSuperior",filterable:""},model:{value:e.form.superior,callback:function(t){e.$set(e.form,"superior",t)},expression:"form.superior"}},e._l(e.superiorOptions,(function(t){return a("el-option",{key:t.id,attrs:{value:t.id,label:t.name,name:"projectSuperiorOption"}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.id))])])})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"主要里程碑",prop:"majorMilestone"}},[a("el-input",{attrs:{name:"majorMilestone"},model:{value:e.form.majorMilestone,callback:function(t){e.$set(e.form,"majorMilestone",t)},expression:"form.majorMilestone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"业务领域",prop:"businessField"}},[a("el-input",{attrs:{name:"businessField"},model:{value:e.form.businessField,callback:function(t){e.$set(e.form,"businessField",t)},expression:"form.businessField"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主要功能",prop:"mainFunction"}},[a("el-input",{attrs:{name:"mainFunction"},model:{value:e.form.mainFunction,callback:function(t){e.$set(e.form,"mainFunction",t)},expression:"form.mainFunction"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目状态"}},[a("el-input",{attrs:{disabled:!0,value:e.status[e.getStatusId(e.form.statusId)].label,name:"statusId"}})],1),e._v(" "),a("el-form-item",[a("div",{attrs:{align:"center"}},[1===e.form.statusId?a("div",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_SUPERIOR"],expression:"['ROLE_SUPERIOR']"}]},[a("el-button",{attrs:{type:"primary"}},[e._v("通过审核")]),e._v(" "),a("el-button",{attrs:{type:"primary"}},[e._v("拒绝立项")])],1):e._e(),e._v(" "),3===e.getStatusId(e.form.statusId)?a("div",[3111===e.form.statusId?a("div",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_PM"],expression:"['ROLE_PM']"}]},[a("el-button",{attrs:{name:"submitInfo",type:"primary"},on:{click:e.onSubmit}},[e._v("修改信息")])],1):a("div",[3===e.getStatusId(e.form.statusId)&&"0"===e.form.statusId.toString().charAt(1)?a("span",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_GLOBAL_CONFIG"],expression:"['ROLE_GLOBAL_CONFIG']"}]},[a("el-button",{attrs:{type:"primary"}},[e._v("建立配置库")])],1):e._e(),e._v(" "),3===e.getStatusId(e.form.statusId)&&"0"===e.form.statusId.toString().charAt(2)?a("span",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_GLOBAL_EPGLEADER"],expression:"['ROLE_GLOBAL_EPGLEADER']"}]},[a("el-button",{attrs:{type:"primary"}},[e._v("分配EPG")])],1):e._e(),e._v(" "),3===e.getStatusId(e.form.statusId)&&"0"===e.form.statusId.toString().charAt(3)?a("span",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_GLOBAL_QAM"],expression:"['ROLE_GLOBAL_QAM']"}]},[a("el-button",{attrs:{type:"primary"}},[e._v("分配QA")])],1):e._e()])]):e._e()])])],1)],1)])}),r=[],l=(a("5ab2"),a("6d57"),a("e10e"),a("2b45"),a("ac9f")),s=a("b775");function c(e){return Object(s["a"])({url:"/employee"+e,method:"get"})}function u(e,t){return Object(s["a"])({url:"/employee"+e,method:"post",data:t})}function d(e){return Object(s["a"])({url:"/employee"+e,method:"delete"})}function p(e){return u("/project_employee_vo",e)}function m(e){return c("/get_project_employee_basics?id="+e.id)}function f(e){return u("/add_project_employee",e)}function g(e){return console.info(e),d("/delete_project_employee?id="+e.projectEmployeeId)}function h(e){return u("/set_role",e)}function v(e){return u("/set_permission",e)}function b(e){return Object(s["a"])({url:"/employee/employees_by_project_id",method:"get",params:{projectId:e}})}function y(e){return Object(s["a"])({url:"/employee/search_employee_by_global_roles",method:"post",data:e})}function _(e){return c("/get_project_manhour_employee?id="+e.id+"&isSubordinate="+e.isSubordinate)}function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function w(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(Object(a),!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var D={inject:["reload"],name:"BaseInfo",data:function(){return{form:null,submitRules:{name:[{required:!0,message:"项目名称不能为空",trigger:"blur"}],clientId:[{required:!0,message:"客户信息不能为空",trigger:"blur"}],scheduledDate:[{required:!0,message:"预定时间不能为空",trigger:"change"}],deliveryDate:[{required:!0,message:"交付时间不能为空",trigger:"change"}],superior:[{required:!0,message:"项目上级不能为空",trigger:"blur"}]},status:this.Constant.projectStatus,superiorOptions:[],loading:!1}},created:function(){var e=this;this.loading=!0,this.form=w({},this.$store.getters.project);var t={current:-1,size:0,searchCondition:"ROLE_SUPERIOR"};y(t).then((function(t){e.superiorOptions=t.data.records})).finally((function(){e.loading=!1}))},methods:{getStatusId:function(e){return parseInt(e.toString().charAt(0))},onSubmit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return e.$message({message:"请完整填写所需字段",type:"error",duration:2e3}),!1;e.$store.dispatch("project/updateProject",e.form).then((function(){e.reload()}))}))}}},O=D,x=a("623f"),S=Object(x["a"])(O,o,r,!1,null,"2d94fe5f",null),R=S.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("el-input",{staticStyle:{width:"20%","min-width":"200px"},attrs:{placeholder:"员工ID",name:"employeeIdSearch",clearable:""},model:{value:e.searchValue.employeeId,callback:function(t){e.$set(e.searchValue,"employeeId",t)},expression:"searchValue.employeeId"}}),e._v(" "),a("el-input",{staticStyle:{width:"20%","min-width":"200px"},attrs:{placeholder:"员工姓名",name:"employeeNameSearch",clearable:""},model:{value:e.searchValue.employeeName,callback:function(t){e.$set(e.searchValue,"employeeName",t)},expression:"searchValue.employeeName"}}),e._v(" "),a("el-select",{staticStyle:{width:"30%","min-width":"120px"},attrs:{multiple:"",placeholder:"员工角色",name:"employeeRolesSearch",clearable:""},model:{value:e.searchValue.roles,callback:function(t){e.$set(e.searchValue,"roles",t)},expression:"searchValue.roles"}},e._l(e.roleOptions,(function(e){return a("el-option",{key:e.name,attrs:{label:e.detail,name:"employeeRolesSearchOption",value:e.name}})})),1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",name:"employeeSearch"},on:{click:e.search,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}}},[a("i",{staticClass:"el-icon-search"}),e._v(" "),a("span",[e._v("搜索")])]),e._v(" "),e.canEdit()?a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_PM"],expression:"['ROLE_PM']"}],attrs:{type:"primary",name:"openAddEmployeeDialog"},on:{click:e.openAddParticipantDialog}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "),a("span",[e._v("添加人员")])]):e._e()],1),e._v(" "),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.table.data}},[a("el-table-column",{attrs:{type:"index",index:e.indexMethod,align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"employeeBasics.employeeId",label:"员工ID",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"employeeBasics.name",label:"姓名",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"roles",label:"角色",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return e._l(i.roles,(function(t){return a("p",{key:t.id},[e._v(e._s(t.detail))])}))}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"permissions",label:"权限",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return e._l(i.permissions,(function(t){return a("p",{key:t.id},[e._v(e._s(e._f("permissionDefine")(t.name)))])}))}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"employeeBasics",label:"基本信息",width:"300","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("el-card",[a("p",[e._v("部门："+e._s(i.employeeBasics.department))]),e._v(" "),a("p",[e._v("电话："+e._s(i.employeeBasics.tel))]),e._v(" "),a("p",[e._v("邮件地址："+e._s(i.employeeBasics.emailAddress))]),e._v(" "),a("p",[e._v("加入时间："+e._s(i.joinTime))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"superiorBasics",label:"上级",width:"300","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[i.superiorBasics?a("el-card",[a("p",[e._v(e._s(i.superiorBasics.name)+"（"+e._s(i.superiorBasics.employeeId)+"）")]),e._v(" "),a("p",[e._v("部门："+e._s(i.superiorBasics.department))]),e._v(" "),a("p",[e._v("电话："+e._s(i.superiorBasics.tel))]),e._v(" "),a("p",[e._v("邮件地址："+e._s(i.superiorBasics.emailAddress))])]):a("span",[a("p",{attrs:{align:"center"}},[e._v("无")])])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[null===i.exitTime?a("span",[e.canEdit()?a("span",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_PM"],expression:"['ROLE_PM']"}]},[a("el-button",{attrs:{type:"text",size:"mini",name:"openSetRolesDialogButton"},on:{click:function(t){return e.openSetRoleDialog(i)}}},[e._v("设置角色")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",name:"openSetPermissionsDialogButton"},on:{click:function(t){return e.openSetPermissionDialog(i)}}},[e._v("设置权限")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",name:"deleteEmployeeButton"},on:{click:function(t){return e.deleteParticipant(i)}}},[e._v("删除")])],1):e._e()]):a("span",{staticStyle:{color:"red","font-size":"13px"}},[e._v("\n              "+e._s(i.exitTime)+"退出\n            ")])]}}])})],1),e._v(" "),a("pagination",{attrs:{total:e.table.total,page:e.table.page,limit:e.table.limit},on:{"update:page":function(t){return e.$set(e.table,"page",t)},"update:limit":function(t){return e.$set(e.table,"limit",t)},pagination:e.getParticipants}})],1),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:"添加人员",visible:e.dialog.addParticipant.show,width:"60%",center:""},on:{"update:visible":function(t){return e.$set(e.dialog.addParticipant,"show",t)}}},[a("el-form",{ref:"addParticipantForm",staticStyle:{width:"80%"},attrs:{model:e.dialog.addParticipant.data,rules:e.dialog.addParticipant.rules,"hide-required-asterisk":!0,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"员工ID",prop:"employeeId"}},[a("el-input",{attrs:{name:"addEmployeeId",clearable:""},model:{value:e.dialog.addParticipant.data.employeeId,callback:function(t){e.$set(e.dialog.addParticipant.data,"employeeId",t)},expression:"dialog.addParticipant.data.employeeId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色",prop:"roles"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{name:"addEmployeeRoles",multiple:"",clearable:""},on:{change:e.autoSetPermission},model:{value:e.dialog.addParticipant.data.roles,callback:function(t){e.$set(e.dialog.addParticipant.data,"roles",t)},expression:"dialog.addParticipant.data.roles"}},e._l(e.roleOptions.slice(1,e.roleOptions.length),(function(e){return a("el-option",{key:e.name,attrs:{label:e.detail,name:"addEmployeeRolesOption",value:e.name}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"权限",prop:"permissions"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{name:"addEmployeePermissions",multiple:"",clearable:""},on:{clear:e.autoSetPermission},model:{value:e.dialog.addParticipant.data.permissions,callback:function(t){e.$set(e.dialog.addParticipant.data,"permissions",t)},expression:"dialog.addParticipant.data.permissions"}},e._l(e.permissionOptions,(function(e){return a("el-option",{key:e.name,attrs:{label:e.detail,value:e.name,name:"addEmployeePermissionsOption",disabled:"bug"===e.name}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"项目上级ID",prop:"superiorKey"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{name:"addEmployeeSuperior",clearable:""},model:{value:e.dialog.addParticipant.data.superiorKey,callback:function(t){e.$set(e.dialog.addParticipant.data,"superiorKey",t)},expression:"dialog.addParticipant.data.superiorKey"}},e._l(e.dialog.addParticipant.superiorOptions,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name+"（"+t.employeeId+"）",value:t.id,disabled:t.employeeId===e.dialog.addParticipant.data.employeeId,name:"addEmployeeSuperiorOption"}})})),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{name:"addEmployeeCancelSubmit"},on:{click:function(t){e.dialog.addParticipant.show=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",name:"addEmployeeSubmit"},on:{click:e.addParticipant}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:e.dialog.setRole.title,visible:e.dialog.setRole.show,width:"30%",center:""},on:{"update:visible":function(t){return e.$set(e.dialog.setRole,"show",t)}}},[a("el-checkbox-group",{attrs:{min:1},model:{value:e.dialog.setRole.data.roles,callback:function(t){e.$set(e.dialog.setRole.data,"roles",t)},expression:"dialog.setRole.data.roles"}},e._l(e.roleOptions,(function(t){return a("el-checkbox",{key:t.name,staticStyle:{width:"70%","margin-left":"20%"},attrs:{label:t.name,name:t.name,disabled:"ROLE_PM"===t.name}},[e._v("\n        "+e._s(t.detail)+"\n      ")])})),1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{name:"setRolesCancelSubmit"},on:{click:function(t){e.dialog.setRole.show=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",name:"setRolesSubmit"},on:{click:e.setRole}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:e.dialog.setPermission.title,visible:e.dialog.setPermission.show,width:"30%",center:""},on:{"update:visible":function(t){return e.$set(e.dialog.setPermission,"show",t)}}},[a("el-checkbox-group",{model:{value:e.dialog.setPermission.data.permissions,callback:function(t){e.$set(e.dialog.setPermission.data,"permissions",t)},expression:"dialog.setPermission.data.permissions"}},e._l(e.permissionOptions,(function(t){return a("el-checkbox",{key:t.name,staticStyle:{width:"70%","margin-left":"20%"},attrs:{name:t.name,label:t.name,disabled:"bug"===t.name}},[e._v("\n        "+e._s(t.detail)+"\n      ")])})),1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{name:"setPermissionsCancelSubmit"},on:{click:function(t){e.dialog.setPermission.show=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",name:"setPermissionSubmit"},on:{click:e.setPermission}},[e._v("确 定")])],1)],1)],1)},P=[],I=(a("cc57"),a("333d")),$=a("cf45");function B(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?B(Object(a),!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):B(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var E={components:{Pagination:I["a"]},data:function(){var e=function(e,t,a){0===t.length&&a(new Error("角色不能为空")),a()};return{loading:!1,project:this.$store.getters.project,table:{data:[],total:0,page:1,limit:10,searchCondition:{employeeId:null,employeeName:null,roles:null}},roleOptions:this.Constant.roles,permissionOptions:this.Constant.permissions,searchValue:{employeeId:"",employeeName:"",roles:[]},dialog:{addParticipant:{show:!1,data:{employeeId:"",roles:[],permissions:[],superiorKey:""},superiorOptions:[],rules:{employeeId:[{required:!0,message:"员工ID不能为空",trigger:"blur"}],roles:[{validator:e,trigger:"blur"}]}},setRole:{title:"",show:!1,data:{projectEmployeeId:"",roles:[]}},setPermission:{title:"",show:!1,data:{projectEmployeeId:"",permissions:[]}}}}},mounted:function(){this.getParticipants()},methods:{indexMethod:function(e){return e+1},canEdit:function(){return 3111===this.project.statusId},getParticipants:function(){var e=this;this.loading=!0,p({current:this.table.page,size:this.table.limit,searchCondition:{projectId:this.project.id,employeeId:this.table.searchCondition.employeeId,employeeName:this.table.searchCondition.employeeName,roles:this.table.searchCondition.roles}}).then((function(t){Object($["b"])(t.data,e.table,e.setSearchValue())})).catch((function(e){console.error(e)})).finally((function(){e.loading=!1}))},search:function(){this.table.page=1,this.table.searchCondition.employeeId=Object($["a"])(this.searchValue.employeeId),this.table.searchCondition.employeeName=Object($["a"])(this.searchValue.employeeName),this.table.searchCondition.roles=Object($["a"])(this.searchValue.roles),this.getParticipants()},setSearchValue:function(){this.searchValue.employeeId=this.table.searchCondition.employeeId,this.searchValue.employeeName=this.table.searchCondition.employeeName,this.searchValue.roles=this.table.searchCondition.roles},addParticipant:function(){var e=this;this.$refs.addParticipantForm.validate((function(t){if(!t)return e.$message({message:"请完整填写所需字段",type:"error",duration:2e3}),!1;f(C({projectKey:e.project.id},e.dialog.addParticipant.data)).then((function(){e.$message({message:"添加成功",type:"success",duration:2e3})})).catch((function(e){console.error(e)})).finally((function(){e.dialog.addParticipant.show=!1,e.getParticipants()}))}))},openAddParticipantDialog:function(){var e=this;this.dialog.addParticipant.superiorOptions=[],m({id:this.project.id}).then((function(t){e.dialog.addParticipant.superiorOptions=t.data})),this.dialog.addParticipant.data.employeeId="",this.dialog.addParticipant.data.roles=[],this.dialog.addParticipant.data.permissions=[],this.dialog.addParticipant.data.superiorKey="",this.dialog.addParticipant.show=!0},deleteParticipant:function(e){var t=this;this.$confirm("确认删除该人员?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,closeOnPressEscape:!1}).then((function(){g({projectEmployeeId:e.id}).then((function(){t.$message.success("删除成功")})).finally((function(){t.getParticipants()}))}))},openSetRoleDialog:function(e){var t=this;this.dialog.setRole.title="设置角色："+e.employeeBasics.name+"（"+e.employeeBasics.employeeId+"）",this.dialog.setRole.data.projectEmployeeId=e.id,this.dialog.setRole.data.roles=[],e.roles.forEach((function(e){t.dialog.setRole.data.roles.push(e.name)})),this.dialog.setRole.show=!0},setRole:function(){var e=this;h(this.dialog.setRole.data).then((function(){e.$message.success("成功")})).catch((function(e){console.error(e)})).finally((function(){e.dialog.setRole.show=!1,e.getParticipants()}))},openSetPermissionDialog:function(e){var t=this;this.dialog.setPermission.title="设置权限："+e.employeeBasics.name+"（"+e.employeeBasics.employeeId+"）",this.dialog.setPermission.data.projectEmployeeId=e.id,this.dialog.setPermission.data.permissions=[],e.permissions.forEach((function(e){t.dialog.setPermission.data.permissions.push(e.name)})),this.dialog.setPermission.show=!0},setPermission:function(){var e=this;v(this.dialog.setPermission.data).then((function(t){e.$message.success("成功")})).catch((function(e){console.error(e)})).finally((function(){e.dialog.setPermission.show=!1,e.getParticipants()}))},autoSetPermission:function(){var e=this.dialog.addParticipant.data.permissions.indexOf("bug");this.dialog.addParticipant.data.roles.some((function(e){return"ROLE_PM"===e||"ROLE_DEVLEADER"===e||"ROLE_TESTLEADER"===e}))?-1===e&&this.dialog.addParticipant.data.permissions.push("bug"):e>-1&&this.dialog.addParticipant.data.permissions.splice(e,1)}}},T=E,L=Object(x["a"])(T,j,P,!1,null,null,null),W=L.exports,V=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("h3",[e._v("功能列表")]),e._v(" "),a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.functionList,props:e.defaultProps},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,n=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(i.label))]),e._v(" "),a("span",[e._v("\n        "+e._s(n.detail)+"\n      ")])])}}])}),e._v(" "),a("div",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_PM"],expression:"['ROLE_PM']"}]},[a("upload-excel-component",{attrs:{"on-success":e.handleSuccess,"before-upload":e.beforeUpload}}),e._v(" "),a("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.tableData,border:"","highlight-current-row":""}},e._l(e.tableHeader,(function(e){return a("el-table-column",{key:e,attrs:{prop:e,label:e}})})),1)],1),e._v(" "),a("div",{staticClass:"components-container"},[a("el-button",{staticStyle:{margin:"0 0 20px 20px",float:"right"},attrs:{loading:e.downloadLoading,type:"primary",icon:"el-icon-document",name:"downloadFunctionList"},on:{click:e.handleDownload}},[e._v("\n      导出Excel\n    ")]),e._v(" "),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_PM"],expression:"['ROLE_PM']"}],staticStyle:{margin:"0 0 20px 20px",float:"right"},attrs:{loading:e.uploadLoading,type:"primary",icon:"el-icon-document",name:"uploadFunctionList"},on:{click:e.handleUpload}},[e._v("\n      上传Excel\n    ")])],1)],1)},H=[],M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("input",{ref:"excel-upload-input",staticClass:"excel-upload-input",attrs:{type:"file",accept:".xlsx, .xls",name:"excel-upload-input"},on:{change:e.handleClick}}),e._v(" "),a("div",{staticClass:"drop",on:{drop:e.handleDrop,dragover:e.handleDragover,dragenter:e.handleDragover}},[e._v("\n    拖拽文件至此 或\n    "),a("el-button",{staticStyle:{"margin-left":"16px"},attrs:{loading:e.loading,size:"mini",type:"primary",name:"handleUpload"},on:{click:e.handleUpload}},[e._v("\n      浏览文件\n    ")])],1)])},F=[],N=a("3f81"),A=a.n(N),z={props:{beforeUpload:Function,onSuccess:Function},data:function(){return{loading:!1,excelData:{header:null,results:null}}},methods:{generateData:function(e){var t=e.header,a=e.results;this.excelData.header=t,this.excelData.results=a,this.onSuccess&&this.onSuccess(this.excelData)},handleDrop:function(e){if(e.stopPropagation(),e.preventDefault(),!this.loading){var t=e.dataTransfer.files;if(1===t.length){var a=t[0];if(!this.isExcel(a))return this.$message.error("Only supports upload .xlsx, .xls, .csv suffix files"),!1;this.upload(a),e.stopPropagation(),e.preventDefault()}else this.$message.error("Only support uploading one file!")}},handleDragover:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},handleUpload:function(){this.$refs["excel-upload-input"].click()},handleClick:function(e){var t=e.target.files,a=t[0];a&&this.upload(a)},upload:function(e){if(this.$refs["excel-upload-input"].value=null,this.beforeUpload){var t=this.beforeUpload(e);t&&this.readerData(e)}else this.readerData(e)},readerData:function(e){var t=this;return this.loading=!0,new Promise((function(a,i){var n=new FileReader;n.onload=function(e){var i=e.target.result,n=A.a.read(i,{type:"array"}),o=n.SheetNames[0],r=n.Sheets[o],l=t.getHeaderRow(r),s=A.a.utils.sheet_to_json(r);t.generateData({header:l,results:s}),t.loading=!1,a()},n.readAsArrayBuffer(e)}))},getHeaderRow:function(e){var t,a=[],i=A.a.utils.decode_range(e["!ref"]),n=i.s.r;for(t=i.s.c;t<=i.e.c;++t){var o=e[A.a.utils.encode_cell({c:t,r:n})],r="UNKNOWN "+t;o&&o.t&&(r=A.a.utils.format_cell(o)),a.push(r)}return a},isExcel:function(e){return/\.(xlsx|xls|csv)$/.test(e.name)}}},q=z,U=(a("7d4c"),Object(x["a"])(q,M,F,!1,null,"e17d0904",null)),G=U.exports,Y={name:"UploadExcel",inject:["reload"],components:{UploadExcelComponent:G},data:function(){return{loading:!1,tableData:[],tableHeader:[],downloadLoading:!1,functionList:[],defaultProps:{children:"children",label:"label"},uploadLoading:!1,file:null}},mounted:function(){var e=this;this.loading=!0;var t=this.$store.getters.features;null===t?this.$store.dispatch("feature/getFeatures").then((function(t){console.log(JSON.stringify(t)),e.functionList=t})).finally((function(){e.loading=!1})):(this.functionList=t,this.loading=!1)},methods:{beforeUpload:function(e){var t=e.size/1024/1024<1;return t?(this.file=e,!0):(this.$message({message:"Please do not upload files larger than 1m in size.",type:"warning"}),!1)},handleUpload:function(){var e=this;this.uploadLoading=!0,this.$store.dispatch("feature/uploadFeatures",this.file).then((function(t){e.$store.dispatch("feature/setFeatures",null).then((function(){e.reload(),e.$message({type:"success",message:"成功上传",duration:2e3})}))})).catch((function(t){e.uploadLoading=!1}))},handleSuccess:function(e){var t=e.results,a=e.header;this.tableData=t,this.tableHeader=a},handleDownload:function(){var e=this;this.downloadLoading=!0,this.$store.dispatch("feature/downloadExcel").then((function(t){e.downloadLoading=!1,e.$message({type:"success",message:"下载成功",duration:2e3})})).catch((function(t){e.downloadLoading=!1}))}}},K=Y,Q=(a("9210"),Object(x["a"])(K,V,H,!1,null,"dd0928e6",null)),J=Q.exports,X=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("el-input",{staticStyle:{width:"15%","min-width":"200px"},attrs:{placeholder:"风险ID",name:"riskIdSearch",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getRisk(t)}},model:{value:e.searchValue.id,callback:function(t){e.$set(e.searchValue,"id",t)},expression:"searchValue.id"}}),e._v(" "),a("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"风险类型",name:"riskTypeSearch"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getRisk(t)}},model:{value:e.searchValue.type,callback:function(t){e.$set(e.searchValue,"type",t)},expression:"searchValue.type"}}),e._v(" "),a("el-input",{staticStyle:{width:"20%","min-width":"200px"},attrs:{placeholder:"风险责任人",name:"riskResponsibleSearch",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getRisk(t)}},model:{value:e.searchValue.name,callback:function(t){e.$set(e.searchValue,"name",t)},expression:"searchValue.name"}}),e._v(" "),a("el-select",{attrs:{placeholder:"风险状态",name:"riskStatusSearch",clearable:""},model:{value:e.searchValue.status,callback:function(t){e.$set(e.searchValue,"status",t)},expression:"searchValue.status"}},e._l(e.riskStatus,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,value:e.id,name:"riskStatusOptionSearch"}})})),1),e._v(" "),a("el-button",{attrs:{icon:"el-icon-search",circle:"",name:"searchRiskButton"},on:{click:e.getRisk}}),e._v(" "),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_PM"],expression:"['ROLE_PM']"}],attrs:{type:"primary",name:"openNewRiskButton"},on:{click:e.openNewRiskDialog}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "),a("span",[e._v("新建风险")])]),e._v(" "),a("el-dialog",{attrs:{title:"新建风险",visible:e.dialogFormVisible_1},on:{"update:visible":function(t){e.dialogFormVisible_1=t}}},[a("el-form",{ref:"newRisk",attrs:{model:e.newRisk,rules:e.riskRules}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"风险类型","label-width":e.formLabelWidth,prop:"type"}},[a("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"请填写风险类型",name:"riskType"},model:{value:e.newRisk.type,callback:function(t){e.$set(e.newRisk,"type",t)},expression:"newRisk.type"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"风险状态","label-width":e.formLabelWidth,prop:"status"}},[a("el-select",{attrs:{placeholder:"风险状态",name:"riskStatus"},model:{value:e.newRisk.status,callback:function(t){e.$set(e.newRisk,"status",t)},expression:"newRisk.status"}},e._l(e.riskStatus,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,value:e.id,name:"newRiskStatusOption"}})})),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"风险级别","label-width":e.formLabelWidth,prop:"level"}},[a("el-select",{attrs:{placeholder:"风险级别",name:"riskLevel"},model:{value:e.newRisk.level,callback:function(t){e.$set(e.newRisk,"level",t)},expression:"newRisk.level"}},e._l(e.riskLevel,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,value:e.id,name:"newRiskLevelOption"}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"风险责任人","label-width":e.formLabelWidth,prop:"responsible"}},[a("el-select",{attrs:{placeholder:"风险责任人",name:"riskResponsible",filterable:""},model:{value:e.newRisk.responsible,callback:function(t){e.$set(e.newRisk,"responsible",t)},expression:"newRisk.responsible"}},e._l(e.employees,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id,name:"newRiskResponsibleOption"}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.id))])])})),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"风险影响度","label-width":e.formLabelWidth,prop:"affect"}},[a("el-select",{attrs:{placeholder:"风险影响度",name:"riskAffect"},model:{value:e.newRisk.affect,callback:function(t){e.$set(e.newRisk,"affect",t)},expression:"newRisk.affect"}},e._l(e.riskAffect,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,value:e.id,name:"newRiskAffectOption"}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"风险跟踪频度(天)","label-width":e.formLabelWidth,required:""}},[a("el-input-number",{attrs:{min:1,max:9999,label:"天数",name:"riskTrackFreq"},model:{value:e.newRisk.trackFreq,callback:function(t){e.$set(e.newRisk,"trackFreq",t)},expression:"newRisk.trackFreq"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"风险相关者","label-width":e.formLabelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"风险相关者",multiple:"",name:"riskRelated",filterable:""},model:{value:e.newRisk.related,callback:function(t){e.$set(e.newRisk,"related",t)},expression:"newRisk.related"}},e._l(e.employees,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id,name:"newRiskRelatedOption"}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.id))])])})),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"风险应对","label-width":e.formLabelWidth,prop:"react"}},[a("el-input",{attrs:{placeholder:"风险应对方法",name:"riskReact",clearable:""},model:{value:e.newRisk.react,callback:function(t){e.$set(e.newRisk,"react",t)},expression:"newRisk.react"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"应对策略","label-width":e.formLabelWidth,prop:"strategy"}},[a("el-input",{attrs:{placeholder:"风险应对策略",name:"riskStrategy",clearable:""},model:{value:e.newRisk.strategy,callback:function(t){e.$set(e.newRisk,"strategy",t)},expression:"newRisk.strategy"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"风险描述","label-width":e.formLabelWidth,prop:"description"}},[a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入风险的描述内容",name:"riskDescription"},model:{value:e.newRisk.description,callback:function(t){e.$set(e.newRisk,"description",t)},expression:"newRisk.description"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{name:"cancelSubmitButton"},on:{click:function(t){e.dialogFormVisible_1=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",name:"submitButton"},on:{click:e.submitRisk}},[e._v("确 定")])],1)],1),e._v(" "),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_PM"],expression:"['ROLE_PM']"}],attrs:{type:"primary",name:"openImportRiskButton"},on:{click:function(t){e.dialogFormVisible_2=!0}}},[e._v("\n      导入已有风险"),a("i",{staticClass:"el-icon-upload el-icon--right"})]),e._v(" "),a("el-dialog",{attrs:{title:"导入风险",visible:e.dialogFormVisible_2},on:{"update:visible":function(t){e.dialogFormVisible_2=t}}},[a("el-form",{attrs:{model:e.form_2}},[a("el-form-item",{attrs:{label:"风险ID","label-width":e.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form_2.riskId,callback:function(t){e.$set(e.form_2,"riskId",t)},expression:"form_2.riskId"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{name:"cancelImportButton"},on:{click:function(t){e.dialogFormVisible_2=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",name:"importButton"},on:{click:function(t){e.dialogFormVisible_2=!1}}},[e._v("确 定")])],1)],1)],1),e._v(" "),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.risks}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"风险 ID"}},[a("span",[e._v(e._s(t.row.id))])]),e._v(" "),a("el-form-item",{attrs:{label:"风险类型"}},[a("span",[e._v(e._s(t.row.type))])]),e._v(" "),a("el-form-item",{attrs:{label:"风险相关者"}},e._l(t.row.related,(function(t){return a("span",[e._v(e._s(t.name+" "))])})),0),e._v(" "),a("el-form-item",{attrs:{label:"风险责任人"}},[a("span",[e._v(e._s(t.row.responsible.name))])]),e._v(" "),a("el-form-item",{attrs:{label:"风险影响度"}},[a("span",[e._v(e._s(t.row.affect))])]),e._v(" "),a("el-form-item",{attrs:{label:"风险应对"}},[a("span",[e._v(e._s(t.row.react))])]),e._v(" "),a("el-form-item",{attrs:{label:"风险状态"}},[a("span",[e._v(e._s(t.row.status))])]),e._v(" "),a("el-form-item",{attrs:{label:"应对策略"}},[a("span",[e._v(e._s(t.row.strategy))])]),e._v(" "),a("el-form-item",{attrs:{label:"跟踪频度"}},[a("span",[e._v(e._s(t.row.trackFreq)+" (天/次)")])]),e._v(" "),a("el-form-item",{attrs:{label:"风险级别"}},[a("span",[e._v(e._s(t.row.level))])]),e._v(" "),a("el-form-item",{attrs:{label:"风险描述"}},[a("span",[e._v(e._s(t.row.description))])])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"风险 ID",name:"idResults",prop:"id"}}),e._v(" "),a("el-table-column",{attrs:{label:"风险类型",prop:"type"}}),e._v(" "),a("el-table-column",{attrs:{label:"风险责任人",prop:"responsible.name"}}),e._v(" "),a("el-table-column",{attrs:{label:"风险状态",prop:"status"}}),e._v(" "),a("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}})]}}])})],1),e._v(" "),a("pagination",{attrs:{total:e.table.total,page:e.table.current,limit:e.table.limit},on:{"update:page":function(t){return e.$set(e.table,"current",t)},"update:limit":function(t){return e.$set(e.table,"limit",t)},pagination:e.getRisk}})],1)])},Z=[],ee={inject:["reload"],components:{Pagination:I["a"]},data:function(){return{riskTypeOptions:this.Constant.riskType,loading:!1,dialogFormVisible_1:!1,dialogFormVisible_2:!1,form_2:{riskId:""},formLabelWidth:"150px",risks:[],employees:null,riskAffect:this.Constant.riskAffect,riskLevel:this.Constant.riskLevel,riskStatus:this.Constant.status,riskRules:this.Constant.riskRules,newRisk:{affect:"",description:"",id:0,level:"",react:"",related:"",responsible:"",status:"",strategy:"",trackFreq:"",type:""},searchValue:{id:"",name:"",status:"",type:""},table:{total:0,limit:10,current:1}}},methods:{handleDelete:function(e,t){console.log(e,t)},getRisk:function(){var e=this;this.loading=!0;var t={current:this.table.current,size:this.table.limit,searchCondition:this.searchValue};this.$store.dispatch("risk/getRisks",t).then((function(t){e.risks=t.records,e.table.total=t.total})).catch((function(e){})).finally((function(){e.loading=!1}))},search:function(){console.log("查询风险")},querySearch:function(e,t){var a=this.riskTypeOptions,i=e?a.filter(this.createFilter(e)):a;t(i)},createFilter:function(e){return function(t){return-1!==t.value.toLowerCase().indexOf(e.toLowerCase())}},openNewRiskDialog:function(){var e=this;if(this.dialogFormVisible_1=!0,null!=this.employees)return this.employees;console.log("后端获取人员信息"),b(this.$store.getters.projectId).then((function(t){return e.employees=t.data,e.employees})).catch((function(e){}))},submitRisk:function(){var e=this;this.$refs["newRisk"].validate((function(t){if(!t)return e.$message({message:"请完整填写所需字段",type:"error",duration:2e3}),!1;e.$store.dispatch("risk/addRisk",e.newRisk).then((function(){e.$store.dispatch("risk/setRisks",null).then((function(){e.reload(),e.$message({type:"success",message:"风险新增成功",duration:2e3})}))})).catch((function(e){}))}))}},mounted:function(){this.getRisk()}},te=ee,ae=(a("fecc"),Object(x["a"])(te,X,Z,!1,null,"c3cf7484",null)),ie=ae.exports,ne=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("div",[a("el-input",{staticStyle:{width:"15%","min-width":"200px"},attrs:{placeholder:"缺陷ID",name:"bugIdSearch",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getBugs(t)}},model:{value:e.searchValue.id,callback:function(t){e.$set(e.searchValue,"id",t)},expression:"searchValue.id"}}),e._v(" "),a("el-input",{staticStyle:{width:"15%","min-width":"200px"},attrs:{placeholder:"缺陷标题",name:"bugTitleSearch",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getBugs(t)}},model:{value:e.searchValue.bugTitle,callback:function(t){e.$set(e.searchValue,"bugTitle",t)},expression:"searchValue.bugTitle"}}),e._v(" "),a("el-input",{staticStyle:{width:"15%","min-width":"200px"},attrs:{placeholder:"缺陷提出人",name:"bugIntroducerSearch",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getBugs(t)}},model:{value:e.searchValue.bugIntroducer,callback:function(t){e.$set(e.searchValue,"bugIntroducer",t)},expression:"searchValue.bugIntroducer"}}),e._v(" "),a("el-select",{staticStyle:{width:"15%","min-width":"120px"},attrs:{placeholder:"状态",name:"bugStatusSearch",clearable:""},model:{value:e.searchValue.status,callback:function(t){e.$set(e.searchValue,"status",t)},expression:"searchValue.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,name:"bugStatusSearchOption",value:e.id}})})),1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",name:"bugSearchButton"},on:{click:e.getBugs}},[a("i",{staticClass:"el-icon-search"}),e._v(" "),a("span",[e._v("搜索")])]),e._v(" "),a("el-button",{attrs:{type:"primary",name:"bugOpenAddBugDialogButton"},on:{click:e.openNewBugDialog}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "),a("span",[e._v("添加缺陷")])]),e._v(" "),a("el-dialog",{attrs:{title:"新建缺陷",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"newBug",attrs:{model:e.newBug,rules:e.bugRules}},[a("el-form-item",{attrs:{label:"标题","label-width":e.formLabelWidth,prop:"bugTitle"}},[a("el-input",{attrs:{autocomplete:"off",name:"newBugTitle"},model:{value:e.newBug.bugTitle,callback:function(t){e.$set(e.newBug,"bugTitle",t)},expression:"newBug.bugTitle"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"缺陷负责人","label-width":e.formLabelWidth,prop:"bugResponsibleId"}},[a("el-select",{attrs:{placeholder:"缺陷负责人",name:"newBugResponsible"},model:{value:e.newBug.bugResponsibleId,callback:function(t){e.$set(e.newBug,"bugResponsibleId",t)},expression:"newBug.bugResponsibleId"}},e._l(e.employees,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,name:"newBugResponsibleOption",value:t.id}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.id))])])})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("div",[a("el-form-item",{attrs:{label:"优先级","label-width":e.formLabelWidth,prop:"priority"}},[a("el-select",{attrs:{placeholder:"请选择优先级",name:"newBugPriority"},model:{value:e.newBug.priority,callback:function(t){e.$set(e.newBug,"priority",t)},expression:"newBug.priority"}},e._l(e.bugPriority,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,name:"newBugPriorityOption",value:e.id}})})),1)],1)],1)])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",[a("el-form-item",{attrs:{label:"开始时间","label-width":e.formLabelWidth,prop:"startTime"}},[a("el-date-picker",{staticStyle:{width:"90%"},attrs:{type:"date",name:"scheduledDate",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd",disabled:""},model:{value:e.newBug.startTime,callback:function(t){e.$set(e.newBug,"startTime",t)},expression:"newBug.startTime"}})],1)],1)]),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"缺陷状态","label-width":e.formLabelWidth,prop:"status"}},[a("el-select",{attrs:{placeholder:"请选择缺陷状态",disabled:""},model:{value:e.newBug.status,callback:function(t){e.$set(e.newBug,"status",t)},expression:"newBug.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,value:e.id}})})),1)],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"缺陷描述","label-width":e.formLabelWidth,prop:"bugDescription"}},[a("el-input",{attrs:{name:"newBugDescription",type:"textarea",rows:4,placeholder:"请输入缺陷的描述内容"},model:{value:e.newBug.bugDescription,callback:function(t){e.$set(e.newBug,"bugDescription",t)},expression:"newBug.bugDescription"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{name:"newBugCancelSubmit"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",name:"newBugSubmit"},on:{click:e.submitBug}},[e._v("确 定")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑缺陷",visible:e.editBugDialogVisible},on:{"update:visible":function(t){e.editBugDialogVisible=t}}},[a("el-form",{ref:"editBugForm",attrs:{model:e.editBug,rules:e.bugRules}},[a("el-form-item",{attrs:{label:"标题","label-width":e.formLabelWidth,prop:"bugTitle"}},[a("el-input",{attrs:{autocomplete:"off",name:"editBugTitle"},model:{value:e.editBug.bugTitle,callback:function(t){e.$set(e.editBug,"bugTitle",t)},expression:"editBug.bugTitle"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",[a("el-form-item",{attrs:{label:"开始时间","label-width":e.formLabelWidth,prop:"startTime"}},[a("el-date-picker",{attrs:{type:"date",name:"startTime",format:"yyyy 年 MM 月 dd 日",disabled:""},model:{value:e.editBug.startTime,callback:function(t){e.$set(e.editBug,"startTime",t)},expression:"editBug.startTime"}})],1)],1)]),e._v(" "),a("el-col",{attrs:{span:12}},[a("div",[a("el-form-item",{attrs:{label:"优先级","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"请选择优先级",name:"editBugPriority"},model:{value:e.editBug.priority,callback:function(t){e.$set(e.editBug,"priority",t)},expression:"editBug.priority"}},e._l(e.bugPriority,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,name:"editBugPriorityOption",value:e.id}})})),1)],1)],1)])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"缺陷负责人","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"缺陷负责人",name:"editBugResponsible"},model:{value:e.editBug.bugResponsibleId,callback:function(t){e.$set(e.editBug,"bugResponsibleId",t)},expression:"editBug.bugResponsibleId"}},e._l(e.employees,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,name:"editBugResponsibleOption",value:t.id}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.id))])])})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"缺陷状态","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"请选择缺陷状态",disabled:4==e.editBug.status,name:"editBugStatus"},model:{value:e.editBug.status,callback:function(t){e.$set(e.editBug,"status",t)},expression:"editBug.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,name:"editBugStatusOption",value:e.id}})})),1)],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"缺陷描述","label-width":e.formLabelWidth,prop:"bugDescription"}},[a("el-input",{attrs:{type:"textarea",rows:4,name:"editBugDescription",placeholder:"请输入缺陷的描述内容"},model:{value:e.editBug.bugDescription,callback:function(t){e.$set(e.editBug,"bugDescription",t)},expression:"editBug.bugDescription"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{name:"editBugCancelSubmit"},on:{click:function(t){e.editBugDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",name:"editBugSubmit"},on:{click:e.submitEditBug}},[e._v("确 定")])],1)],1)],1),e._v(" "),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.bugs.records,"empty-text":"无缺陷条目"}},[a("el-table-column",{attrs:{type:"expand",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"缺陷标题"}},[a("span",[e._v(e._s(t.row.bugTitle))])]),e._v(" "),a("el-form-item",{attrs:{label:"缺陷ID"}},[a("span",[e._v(e._s(t.row.id))])]),e._v(" "),a("el-form-item",{attrs:{label:"提出人"}},[a("span",[e._v(e._s(t.row.bugIntroducer.name))])]),e._v(" "),a("el-form-item",{attrs:{label:"负责人"}},[a("span",[e._v(e._s(t.row.bugResponsible.name))])]),e._v(" "),a("el-form-item",{attrs:{label:"开始时间"}},[a("span",[e._v(e._s(e.dateFormat(t.row.startTime)))])]),e._v(" "),a("el-form-item",{attrs:{label:"结束时间"}},[a("span",[e._v(e._s(e.dateFormat(t.row.endTime)))])]),e._v(" "),a("el-form-item",{attrs:{label:"缺陷状态"}},[a("span",[e._v(e._s(t.row.status))])]),e._v(" "),a("el-form-item",{attrs:{label:"优先级"}},e._l(e.bugPriority,(function(i){return i.id==t.row.priority?a("span",[e._v(e._s(i.value))]):e._e()})),0),e._v(" "),a("el-form-item",{attrs:{label:"缺陷描述"}},[a("span",[e._v(e._s(t.row.bugDescription))])])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"left",prop:"id",label:"缺陷ID",align:"center","min-width":"50"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"left",prop:"bugTitle",label:"标题",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"bugIntroducer.name",label:"提出人",width:"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"缺陷状态",width:"150",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"开始时间",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"el-icon-time"}),e._v(" "),a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(e.dateFormat(t.row.startTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",disabled:"CLOSED"==t.row.status,name:"openEditDialogButton"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑\n          ")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger",name:"bugDeleteButton"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除\n          ")])]}}])})],1),e._v(" "),a("pagination",{attrs:{total:e.bugs.total,page:e.bugs.current,limit:e.bugs.size},on:{"update:page":function(t){return e.$set(e.bugs,"current",t)},"update:limit":function(t){return e.$set(e.bugs,"size",t)},pagination:e.getBugs}})],1)])},oe=[];function re(e,t){return Object(s["a"])({url:"/bug/bugs_by_page",method:"post",params:{projectId:e},data:t})}function le(e,t){return Object(s["a"])({url:"/bug/save_bug",method:"post",params:{projectId:e},data:t})}function se(e,t){return Object(s["a"])({url:"/bug/update_bug",method:"post",params:{projectId:e},data:t})}var ce=a("a186"),ue=a.n(ce),de={inject:["reload"],components:{Pagination:I["a"]},data:function(){return{loading:!1,editBugDialogVisible:!1,searchValue:{id:"",status:"",bugTitle:"",bugIntroducer:""},statusOptions:this.Constant.status,employees:null,bugPriority:this.Constant.bugPriority,bugRules:this.Constant.bugRules,bugs:{size:10,current:1,total:0,records:[]},dialogTableVisible:!1,dialogFormVisible:!1,newBug:{bugTitle:"",bugIntroducerId:"",bugResponsibleId:"",startTime:new Date,endTime:"",bugDescription:"",priority:"",status:"0"},editBug:{bugTitle:"",bugIntroducerId:"",bugResponsibleId:"",startTime:"",endTime:"",bugDescription:"",priority:null,status:null},formLabelWidth:"120px"}},mounted:function(){this.getBugs()},methods:{getBugs:function(){var e=this;this.loading=!0,console.log("查询bug页数为"+this.bugs.current),console.log("查询bug条目数量为"+this.bugs.size);var t={current:this.bugs.current,size:this.bugs.size,searchCondition:this.searchValue};re(this.$store.getters.projectId,t).then((function(t){e.bugs=t.data})).catch((function(e){})).finally((function(){e.loading=!1}))},dateFormat:function(e){return null==e?"未定":ue()(e).format("YYYY年MM月DD日")},openNewBugDialog:function(){var e=this;this.dialogFormVisible=!0,null==this.employees&&(console.log("后端获取人员信息"),b(this.$store.getters.projectId).then((function(t){e.employees=t.data})).catch((function(e){})))},submitBug:function(){var e=this;this.$refs["newBug"].validate((function(t){if(!t)return e.$message({type:"error",message:"请完整填写所需内容",duration:2e3}),!1;le(e.$store.getters.projectId,e.newBug).then((function(){e.reload(),e.$message({type:"success",message:"新增缺陷成功",duration:2e3})})).catch((function(e){}))}))},handleEdit:function(e,t){var a=this;null==this.employees?(console.log("后端获取人员信息"),b(this.$store.getters.projectId).then((function(e){a.employees=e.data,a.setEditBug(t),a.editBugDialogVisible=!0})).catch((function(e){}))):(this.setEditBug(t),this.editBugDialogVisible=!0)},handleDelete:function(e,t){console.log(t)},submitEditBug:function(){var e=this;this.$refs["editBugForm"].validate((function(t){if(!t)return e.$message({type:"error",message:"请完整填写所需内容",duration:2e3}),!1;se(e.$store.getters.projectId,e.editBug).then((function(){e.reload(),e.$message({type:"success",message:"缺陷更新成功",duration:2e3})}))}))},setEditBug:function(e){var t=0;"OPENED"===e.status?t=1:"PROCESSED"===e.status?t=2:"SOLVED"===e.status?t=3:"CLOSED"===e.status&&(t=4),this.editBug.id=e.id,this.editBug.bugTitle=e.bugTitle,this.editBug.bugResponsibleId=e.bugResponsible.id,this.editBug.startTime=e.startTime,this.editBug.bugDescription=e.bugDescription,this.editBug.priority=e.priority.toString(),this.editBug.status=t.toString()}}},pe=de,me=(a("2b1a"),Object(x["a"])(pe,ne,oe,!1,null,null,null)),fe=me.exports,ge=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("el-input",{staticStyle:{width:"15%","min-width":"200px"},attrs:{placeholder:"资产类型",name:"deviceTypeSearch",clearable:""},model:{value:e.searchValue.type,callback:function(t){e.$set(e.searchValue,"type",t)},expression:"searchValue.type"}}),e._v(" "),a("el-select",{staticStyle:{width:"15%","min-width":"120px"},attrs:{placeholder:"设备状态",name:"deviceStatusSearch",clearable:""},model:{value:e.searchValue.deviceCondition,callback:function(t){e.$set(e.searchValue,"deviceCondition",t)},expression:"searchValue.deviceCondition"}},e._l(e.deviceConditionOptions,(function(e){return a("el-option",{key:e.value,attrs:{name:"deviceStatusSearchOption",label:e.label,value:e.value}})})),1),e._v(" "),a("el-select",{staticStyle:{width:"15%","min-width":"120px"},attrs:{placeholder:"是否归还",name:"deviceIsReturnedSearch",clearable:""},model:{value:e.searchValue.isReturned,callback:function(t){e.$set(e.searchValue,"isReturned",t)},expression:"searchValue.isReturned"}},e._l(e.isReturnedOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,name:"deviceIsReturnedSearchOption",value:e.value}})})),1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",name:"deviceSearchButton"},on:{click:e.search,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}}},[a("i",{staticClass:"el-icon-search"}),e._v(" "),a("span",[e._v("搜索")])]),e._v(" "),e.canAdd?a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ROLE_GLOBAL_DEVM"],expression:"['ROLE_GLOBAL_DEVM']"}],attrs:{name:"openAddDeviceDialogButton",type:"primary"},on:{click:e.openAddDeviceDialog}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "),a("span",[e._v("添加设备")])]):e._e()],1),e._v(" "),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.table.data}},[a("el-table-column",{attrs:{type:"index",index:e.indexMethod,align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:"资产类型",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"资产管理者",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.managerBasics.name+"（"+i.managerBasics.employeeId+"）"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"usageTimeLimit",label:"资产使用期限",width:"300",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceCondition",label:"设备状态",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[i.deviceCondition?a("span",[e._v("完好")]):a("span",[e._v("损坏")]),e._v(" "),i.isReturned?e._e():a("el-button",{attrs:{name:"deviceChangeStatusButton",type:"text",size:"mini"},on:{click:function(t){return e.updateDeviceCondition(i)}}},[i.deviceCondition?a("span",[e._v("损坏")]):a("span",[e._v("完好")])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"isReturned",label:"是否归还",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[i.isReturned?a("span",[e._v("已归还")]):a("span",[a("span",[e._v("未归还")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",name:"deviceReturnButton"},on:{click:function(t){return e.updateIsReturned(i)}}},[e._v("归还")])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"returnDate",label:"归还日期",width:"300",align:"center"}})],1),e._v(" "),a("pagination",{attrs:{total:e.table.total,page:e.table.page,limit:e.table.limit},on:{"update:page":function(t){return e.$set(e.table,"page",t)},"update:limit":function(t){return e.$set(e.table,"limit",t)},pagination:e.getDevices}})],1),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:"添加设备",visible:e.addDeviceDialog.show,width:"60%",center:""},on:{"update:visible":function(t){return e.$set(e.addDeviceDialog,"show",t)}}},[a("el-form",{ref:"addDeviceForm",staticStyle:{width:"80%"},attrs:{model:e.addDeviceDialog.data,rules:e.addDeviceDialog.rules,"hide-required-asterisk":!0,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"设备类型",prop:"type"}},[a("el-input",{attrs:{name:"addDeviceType",clearable:""},model:{value:e.addDeviceDialog.data.type,callback:function(t){e.$set(e.addDeviceDialog.data,"type",t)},expression:"addDeviceDialog.data.type"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"使用期限",prop:"usageTimeLimit"}},[a("el-date-picker",{attrs:{name:"addDeviceUsageTimeLimit",type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.addDeviceDialog.data.usageTimeLimit,callback:function(t){e.$set(e.addDeviceDialog.data,"usageTimeLimit",t)},expression:"addDeviceDialog.data.usageTimeLimit"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备状态",prop:"deviceCondition"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{name:"addDeviceStatus"},model:{value:e.addDeviceDialog.data.deviceCondition,callback:function(t){e.$set(e.addDeviceDialog.data,"deviceCondition",t)},expression:"addDeviceDialog.data.deviceCondition"}},e._l(e.deviceConditionOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{name:"addDeviceCancelSubmit"},on:{click:function(t){e.addDeviceDialog.show=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",name:"addDeviceSubmit"},on:{click:e.addDevice}},[e._v("确 定")])],1)],1)],1)},he=[],ve=a("c466");function be(e,t){return Object(s["a"])({url:"/device"+e,method:"post",data:t})}function ye(e){return be("/search_properties",e)}function _e(e){return be("/add_property",e)}function ke(e){return be("/update_property",e)}function we(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function De(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?we(Object(a),!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):we(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Oe={components:{Pagination:I["a"]},data:function(){return{project:this.$store.getters.project,loading:!1,table:{data:[],total:0,page:1,limit:10,searchCondition:{type:null,deviceCondition:null,isReturned:null}},searchValue:{type:"",deviceCondition:"",isReturned:""},deviceConditionOptions:this.Constant.deviceConditions,isReturnedOptions:this.Constant.isReturned,addDeviceDialog:{show:!1,data:{type:"",usageTimeLimit:"",deviceCondition:!0},rules:{type:[{required:!0,message:"设备类型不能为空",trigger:"blur"}]}}}},mounted:function(){this.getDevices()},methods:{indexMethod:function(e){return e+1},canAdd:function(){return"3"===this.project.status.toString().charAt(0)},getDevices:function(){var e=this;this.loading=!0,ye({current:this.table.page,size:this.table.limit,searchCondition:De({projectId:this.project.id},this.table.searchCondition)}).then((function(t){Object($["b"])(t.data,e.table,e.setSearchCondition)})).finally((function(){e.loading=!1}))},search:function(){this.table.page=1,this.table.searchCondition.type=Object($["a"])(this.searchValue.type),this.table.searchCondition.deviceCondition=Object($["a"])(this.searchValue.deviceCondition),this.table.searchCondition.isReturned=Object($["a"])(this.searchValue.isReturned),this.getDevices()},setSearchCondition:function(){this.searchValue.type=this.table.searchCondition.type,this.searchValue.deviceCondition=this.table.searchCondition.deviceCondition,this.searchValue.isReturned=this.table.searchCondition.isReturned},addDevice:function(){var e=this;this.$refs.addDeviceForm.validate((function(t){t?_e(De({projectId:e.project.id},e.addDeviceDialog.data)).then((function(t){e.$message.success("成功")})).finally((function(){e.addDeviceDialog.show=!1,e.getDevices()})):e.$message({type:"error",message:"请完整填写所需字段",duration:2e3})}))},openAddDeviceDialog:function(){this.addDeviceDialog.data.type="",this.addDeviceDialog.data.usageTimeLimit=Object(ve["a"])(new Date),this.addDeviceDialog.data.deviceCondition=!0,this.addDeviceDialog.show=!0},updateDevice:function(e){var t=this;ke(e).then((function(e){t.$message.success("成功")})).finally((function(){t.getDevices()}))},updateDeviceCondition:function(e){this.updateDevice({id:e.id,deviceCondition:!e.deviceCondition})},updateIsReturned:function(e){this.updateDevice({id:e.id,isReturned:!0,returnDate:Object(ve["a"])(new Date)})}}},xe=Oe,Se=Object(x["a"])(xe,ge,he,!1,null,"653ec2c9",null),Re=Se.exports,je=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[e.show.my?a("el-tab-pane",{attrs:{label:"我的工时",name:"my"}},["my"===e.activeName?a("work-hour",{attrs:{type:1}}):e._e()],1):e._e(),e._v(" "),e.show.all?a("el-tab-pane",{attrs:{label:"所有工时",name:"all"}},["all"===e.activeName?a("work-hour",{attrs:{type:3}}):e._e()],1):e._e(),e._v(" "),a("el-tab-pane",{attrs:{label:"审核工时",name:"audit"}},["audit"===e.activeName?a("work-hour",{attrs:{type:2}}):e._e()],1)],1)],1)},Pe=[],Ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[1!==e.type?a("el-select",{staticStyle:{width:"15%","min-width":"200px"},attrs:{placeholder:"选择员工",clearable:""},model:{value:e.searchValue.employeeId,callback:function(t){e.$set(e.searchValue,"employeeId",t)},expression:"searchValue.employeeId"}},e._l(e.options.employeeOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name+"（"+e.employeeId+"）",value:e.id}})})),1):e._e(),e._v(" "),a("el-date-picker",{staticStyle:{width:"15%","min-width":"200px"},attrs:{name:"date",type:"date",format:"yyyy-MM-dd",placeholder:"日期",clearable:""},model:{value:e.searchValue.startTime,callback:function(t){e.$set(e.searchValue,"startTime",t)},expression:"searchValue.startTime"}}),e._v(" "),a("el-select",{staticStyle:{width:"15%","min-width":"120px"},attrs:{placeholder:"审核状态",clearable:""},model:{value:e.searchValue.auditingStatus,callback:function(t){e.$set(e.searchValue,"auditingStatus",t)},expression:"searchValue.auditingStatus"}},e._l(e.options.auditingStatusOptions,(function(t,i){return a("el-option",{key:i,attrs:{label:t,value:i,disabled:2===e.type&&3===i}})})),1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.search,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}}},[a("i",{staticClass:"el-icon-search"}),e._v(" "),a("span",[e._v("搜索")])]),e._v(" "),1===e.type?a("el-button",{attrs:{type:"primary"},on:{click:e.openAddWorkHourDialog}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "),a("span",[e._v("添加工时信息")])]):e._e()],1),e._v(" "),a("div",[a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.table.data,"empty-text":"无工时条目"}},[a("el-table-column",{attrs:{prop:"employeeBasics.employeeId",label:"员工ID",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"employeeBasics.name",label:"姓名",align:"center","min-width":"40"}}),e._v(" "),a("el-table-column",{attrs:{label:"日期",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.getDate(i.startTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"时间",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.getTime(i.startTime))+" - "+e._s(e.getTime(i.endTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"功能名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.featureName?i.featureName:e.getTreeLabel(e.options.featureOptions,i.featureId)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"活动名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.getTreeLabel(e.options.activityOptions,i.activityId)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"审核状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.options.auditingStatusOptions[i.auditingStatus]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e.canUpdate(i)?a("span",[1===e.type?a("span",[a("el-button",{staticStyle:{color:"#E6A23C"},attrs:{type:"text"},on:{click:function(t){return e.openUpdateWorkHourDialog(i)}}},[e._v("修改")]),e._v(" "),a("el-button",{staticStyle:{color:"#E6A23C"},attrs:{type:"text"},on:{click:function(t){return e.withdraw(i)}}},[e._v("撤销")])],1):a("span",[a("el-button",{staticStyle:{color:"#85ce61"},attrs:{type:"text"},on:{click:function(t){return e.pass(i)}}},[e._v("通过")]),e._v(" "),a("el-button",{staticStyle:{color:"#f78989"},attrs:{type:"text"},on:{click:function(t){return e.refuse(i)}}},[e._v("驳回")])],1)]):e._e()]}}])})],1)],1),e._v(" "),a("pagination",{attrs:{total:e.table.total,page:e.table.page,limit:e.table.limit},on:{"update:page":function(t){return e.$set(e.table,"page",t)},"update:limit":function(t){return e.$set(e.table,"limit",t)},pagination:e.getWorkHour}})],1),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:e.addWorkHourDialog.title[e.addWorkHourDialog.type],visible:e.addWorkHourDialog.show,width:"500px",center:""},on:{"update:visible":function(t){return e.$set(e.addWorkHourDialog,"show",t)}}},[a("el-form",{ref:"addWorkHourForm",attrs:{model:e.addWorkHourDialog.data,rules:e.addWorkHourDialog.rules,"hide-required-asterisk":!0,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"日期",prop:"date"}},[a("el-date-picker",{attrs:{name:"addWorkHourDate",type:"date","picker-options":e.options.dateOptions,clearable:!1},model:{value:e.addWorkHourDialog.data.date,callback:function(t){e.$set(e.addWorkHourDialog.data,"date",t)},expression:"addWorkHourDialog.data.date"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"起始时间",prop:"startTime"}},[a("el-time-picker",{attrs:{name:"addWorkHourStartTime","picker-options":e.options.startTimeOptions,clearable:!1},model:{value:e.addWorkHourDialog.data.startTime,callback:function(t){e.$set(e.addWorkHourDialog.data,"startTime",t)},expression:"addWorkHourDialog.data.startTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间",prop:"endTime"}},[a("el-time-picker",{attrs:{name:"addWorkHourEndTime","picker-options":{selectableRange:e.addWorkHourDialog.data.startTime+" - 23:59:59"},clearable:!1},model:{value:e.addWorkHourDialog.data.endTime,callback:function(t){e.$set(e.addWorkHourDialog.data,"endTime",t)},expression:"addWorkHourDialog.data.endTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"功能名称",prop:"feature"}},[a("el-cascader",{staticStyle:{width:"300px"},attrs:{name:"addWorkHourActivity",options:e.options.featureOptions,props:{expandTrigger:"hover",value:"id"}},model:{value:e.addWorkHourDialog.data.feature,callback:function(t){e.$set(e.addWorkHourDialog.data,"feature",t)},expression:"addWorkHourDialog.data.feature"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"活动名称",prop:"activity"}},[a("el-cascader",{staticStyle:{width:"300px"},attrs:{name:"addWorkHourActivityId",options:e.options.activityOptions,props:{expandTrigger:"hover",value:"id",label:"name"}},model:{value:e.addWorkHourDialog.data.activity,callback:function(t){e.$set(e.addWorkHourDialog.data,"activity",t)},expression:"addWorkHourDialog.data.activity"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addWorkHourDialog.show=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addOrUpdateWorkHour}},[e._v("确 定")])],1)],1)],1)},$e=[],Be=(a("163d"),a("4703"));function Ce(e){return Object(s["a"])({url:"/manhour"+e,method:"get"})}function Ee(e,t){return Object(s["a"])({url:"/manhour"+e,method:"post",data:t})}function Te(){return Ce("/activities")}function Le(e){return Ee("/add_manhour",e)}function We(e){return Ee("/update_manhour",e)}function Ve(e){return Ee("/search_manhour",e)}function He(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function Me(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?He(Object(a),!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):He(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Fe={components:{Pagination:I["a"]},props:{type:{type:Number,default:1}},data:function(){return{project:this.$store.getters.project,searchValue:{employeeId:"",startTime:"",auditingStatus:""},options:{auditingStatusOptions:["审核中","已通过","已驳回","已撤回"],employeeOptions:[],featureOptions:[],activityOptions:[],dateOptions:{disabledDate:function(e){return e.getTime()<(new Date).getTime()-3456e5||e.getTime()>Date.now()}},startTimeOptions:{selectableRange:"00:00:00 - 23:59:59"}},loading:!1,table:{data:[],total:0,page:1,limit:10,searchCondition:{employeeId:"",startTime:"",auditingStatus:""}},addWorkHourDialog:{show:!1,title:["添加工时信息","修改工时信息"],type:0,data:{id:"",date:"",startTime:"",endTime:"",feature:[],featureId:"",activity:[],activityId:""},rules:{feature:[{required:!0,message:"功能名称不能为空",trigger:"blur"}],activity:[{required:!0,message:"活动名称不能为空",trigger:"blur"}]}}}},mounted:function(){this.getFeatures(),this.getActivities(),1!==this.type&&this.getProjectEmployees(),this.getWorkHour()},methods:{getDate:function(e){return Object(ve["b"])(e)},getTime:function(e){return Object(ve["c"])(e)},getWorkHour:function(){var e=this;this.loading=!0,Ve({current:this.table.page,size:this.table.limit,searchCondition:{projectId:this.project.id,employeeId:this.table.searchCondition.employeeId,startTime:this.table.searchCondition.startTime,auditingStatus:this.table.searchCondition.auditingStatus,type:this.type}}).then((function(t){Object($["b"])(t.data,e.table,e.setSearchValue())})).finally((function(){e.loading=!1}))},search:function(){this.table.page=1,this.table.searchCondition.employeeId=Object($["a"])(this.searchValue.employeeId);var e=this.searchValue.startTime;this.table.searchCondition.startTime=e?new Date(e.getFullYear(),e.getMonth(),e.getDate(),8,0,0):null,this.table.searchCondition.auditingStatus=Object($["a"])(this.searchValue.auditingStatus),this.getWorkHour()},setSearchValue:function(){this.searchValue.employeeId=this.table.searchCondition.employeeId,this.searchValue.startTime=this.table.searchCondition.startTime,this.searchValue.auditingStatus=this.table.searchCondition.auditingStatus},getFeatures:function(){var e=this;Object(Be["b"])(this.project.projectId).then((function(t){e.options.featureOptions=t.data}))},getActivities:function(){var e=this;Te().then((function(t){e.options.activityOptions=t.data}))},getProjectEmployees:function(){var e=this;_({id:this.project.id,isSubordinate:2===this.type}).then((function(t){e.options.employeeOptions=t.data}))},addOrUpdateWorkHour:function(){var e=this;this.$refs.addWorkHourForm.validate((function(t){if(t){var a=e.addWorkHourDialog.data.date,i=e.addWorkHourDialog.data.startTime,n=e.addWorkHourDialog.data.endTime;e.addWorkHourDialog.data.startTime=new Date(a.getFullYear(),a.getMonth(),a.getDate(),i.getHours()+8,i.getMinutes(),i.getSeconds()),e.addWorkHourDialog.data.endTime=new Date(a.getFullYear(),a.getMonth(),a.getDate(),n.getHours()+8,n.getMinutes(),n.getSeconds());var o=e.addWorkHourDialog.data.feature;e.addWorkHourDialog.data.featureId=o[1];var r=e.addWorkHourDialog.data.activity;switch(e.addWorkHourDialog.data.activityId=r[1],e.addWorkHourDialog.type){case 0:e.addWorkHour();break;case 1:e.updateWorkHour(e.addWorkHourDialog.data);break}}}))},addWorkHour:function(){var e=this;Le(Me({projectId:this.project.id},this.addWorkHourDialog.data)).then((function(t){e.$message.success("成功")})).finally((function(){e.addWorkHourDialog.show=!1,e.getWorkHour()}))},openAddWorkHourDialog:function(){this.addWorkHourDialog.type=0,this.addWorkHourDialog.data.id=null,this.addWorkHourDialog.data.date=new Date,this.addWorkHourDialog.data.startTime=new Date(1900,1,1,0,0,0),this.addWorkHourDialog.data.endTime=new Date(1900,1,1,23,59,59),this.addWorkHourDialog.data.feature="",this.addWorkHourDialog.data.featureId="",this.addWorkHourDialog.data.activity="",this.addWorkHourDialog.data.activityId="",this.addWorkHourDialog.show=!0},openUpdateWorkHourDialog:function(e){this.addWorkHourDialog.type=1,this.addWorkHourDialog.data.id=e.id,this.addWorkHourDialog.data.date=new Date(e.startTime),this.addWorkHourDialog.data.startTime=new Date(e.startTime),this.addWorkHourDialog.data.endTime=new Date(e.endTime),this.addWorkHourDialog.data.feature=this.getTreeValue(this.options.featureOptions,e.featureId),this.addWorkHourDialog.data.featureId=e.featureId,this.addWorkHourDialog.data.activity=this.getTreeValue(this.options.activityOptions,e.activityId),this.addWorkHourDialog.data.activityId=e.activityId,this.addWorkHourDialog.show=!0},getTree:function(e,t){for(var a=0;a<e.length;a++)for(var i=e[a].children,n=0;n<i.length;n++)if(i[n].id===t)return[e[a],i[n]]},getTreeValue:function(e,t){var a=this.getTree(e,t);return[a[0].id,a[1].id]},getTreeLabel:function(e,t){var a=this.getTree(e,t);if(a){if(a[0].label)return a[0].label+" / "+a[1].label;if(a[0].name)return a[0].name+" / "+a[1].name}},updateWorkHour:function(e){var t=this;We(e).then((function(){t.$message.success("成功")})).finally((function(){t.addWorkHourDialog.show=!1,t.getWorkHour()}))},withdraw:function(e){var t=this;this.$confirm("确定撤销?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,closeOnPressEscape:!1}).then((function(){t.updateWorkHour({id:e.id,auditingStatus:3})}))},pass:function(e){this.updateWorkHour({id:e.id,auditingStatus:1})},refuse:function(e){var t=this;this.$confirm("确定驳回?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,closeOnPressEscape:!1}).then((function(){t.updateWorkHour({id:e.id,auditingStatus:2})}))},canUpdate:function(e){var t=new Date(e.startTime);return t.setHours(0),t.setMinutes(0),t.setSeconds(0),3!==this.type&&0===e.auditingStatus&&t.getTime()+3456e5>(new Date).getTime()}}},Ne=Fe,Ae=Object(x["a"])(Ne,Ie,$e,!1,null,"432987a4",null),ze=Ae.exports,qe=(a("ed63"),a("8cf2"),a("4360"));function Ue(e){if(e&&e instanceof Array&&e.length>0){var t=qe["a"].getters&&qe["a"].getters.roles,a=e,i=t.some((function(e){return a.includes(e)}));return!!i}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}var Ge={components:{WorkHour:ze},data:function(){return{activeName:"my",addWorkHourPermission:["ROLE_DEVLEADER","ROLE_DEV","ROLE_TESTLEADER","ROLE_TEST","ROLE_QA"],readAllWorkHourPermission:["ROLE_PM","ROLE_SUPERIOR"],show:{my:!0,all:!0,audit:!0}}},mounted:function(){this.show.my=Ue(this.addWorkHourPermission),this.show.all=Ue(this.readAllWorkHourPermission),this.activeName=this.show.my?"my":this.show.all?"all":"audit"}},Ye=Ge,Ke=Object(x["a"])(Ye,je,Pe,!1,null,null,null),Qe=Ke.exports,Je=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("h2",{attrs:{align:"center"}},[e._v("未提交资产")]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.assetData,"empty-text":"无未提交资产"}},[a("el-table-column",{attrs:{prop:"asset",label:"未提交资产项",align:"center","min-width":"40"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"}},[e._v("提交")])]}}])})],1)],1),e._v(" "),a("div",[a("h2",{attrs:{align:"center"}},[e._v("已提交资产")]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.submitData,"empty-text":"暂无提交资产"}},[a("el-table-column",{attrs:{prop:"assetSubmitted",label:"已提交资产项",align:"center","min-width":"40"}}),e._v(" "),a("el-table-column",{attrs:{prop:"time",label:"提交时间",align:"center","min-width":"70"}})],1)],1)])},Xe=[],Ze={data:function(){return{assetData:[{asset:"项目基础数据表"},{asset:"项目提案书"},{asset:"项目报价书"}],submitData:[{assetSubmitted:"项目成本管理表",time:"2020-02-11"},{assetSubmitted:"开发工具",time:"2020-02-24"}]}}},et=Ze,tt=Object(x["a"])(et,Je,Xe,!1,null,"408e7cc4",null),at=tt.exports,it={components:{BaseInfo:R,Participant:W,FunctionList:J,Risk:ie,Defect:fe,Device:Re,WorkHour:Qe,File:at},data:function(){return{menuCollapse:!1,menu:[{index:"base-info",class:"base-info",title:"项目信息"},{index:"participant",class:"participant",title:"项目人员"},{index:"function-list",class:"function-list",title:"功能列表"},{index:"risk",class:"risk",title:"风险管理"},{index:"defect",class:"defect",title:"缺陷管理"},{index:"device",class:"device",title:"设备管理"},{index:"work-hour",class:"work-hour",title:"工时信息"},{index:"file",class:"file",title:"归档管理"}],activeMenu:null,project:this.$store.getters.project}},created:function(){this.activeMenu=sessionStorage.getItem("project-detail-menu-index")?sessionStorage.getItem("project-detail-menu-index"):this.menu[0].index},mounted:function(){null===this.project&&(this.$message.warning("请选择具体项目"),this.$router.replace({path:"/"}))},methods:{handleSelect:function(e){this.activeMenu=e,sessionStorage.setItem("project-detail-menu-index",this.activeMenu)},getDate:function(e){return Object(ve["b"])(e)}}},nt=it,ot=Object(x["a"])(nt,i,n,!1,null,null,null);t["default"]=ot.exports},f82d:function(e,t,a){},fecc:function(e,t,a){"use strict";var i=a("d2f8"),n=a.n(i);n.a}}]);